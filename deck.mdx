import Code from './Code.jsx';
import { highlight } from '@mdx-deck/themes'
import { prism } from '@mdx-deck/themes'


# UI Testing ğŸ§ª

By John Brennan ğŸ‘¨ğŸ¼â€ğŸ’»

---

### What are we talking about? ğŸ¤·ğŸ¼â€â™‚ï¸

The journey so far

How to test: strategies!

---

## Whats the point? ğŸ¤”

We ğŸ‘ need ğŸ‘ confidence ğŸ‘

---

### What do I actually test? ğŸ¤¯

Where the business value is!

---

## The journey so far ğŸš²

---

#### We use [Jest](https://jestjs.io/) ğŸƒ

_One stop shop framework_

Implements a DOM to use for testing

Amazing well documented API

---

#### [`@vue/test-utils`](https://vue-test-utils.vuejs.org/) is used in MIS

It works... but _I think_ it is a bit clunky.

---

### What were the issues in testing so far ğŸ›

- Where snapshot tests fit in

- Testing implementation details

- Needing to mock too much

- Tests are verbose

- Tests take ages to run

---

#### Where do I focus my efforts?

<div style={{ width: '30vw' }}>
  <img src="https://react-dublinjs-jan-2019.netlify.com/images/ee5dea20aa19c85a011723f54e8585e3-testing-trophy.png" />
  <div style={{ marginTop: '20px', fontSize: '1rem', fontWeight: 800, textAlign: 'center' }}>Image from testingjavascript.com</div>
</div>

---

## How to test :muscle:

---

### Enter [`@testing-library/vue`](https://testing-library.com/) ğŸ’ƒ

---

#### Making tests resilient to change ğŸ’…ğŸ»

---

#### Sample `<vs-input />` component

<Code>
{`
  <template>
    <div class="fancyInput">
      <label :for="id" v-if="$slots.default"><slot /></label>
      <input
        :id="id"
        v-bind="$attrs"
        v-on:input="$emit('input', $event.target.value)"
      />
    </div>
  </template>
`}
</Code>

---

### Why and how do I test this? ğŸ¤”

---

### Selectors for the job ğŸ‘¨â€ğŸ”§

<div style={{ display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
  <div style={{ marginBottom: 50 }}>
    âŒ
    <Code inline>{`.myFancyInputStyles / .johnsButton`}</Code>
  </div>


  <div>
    âœ…
    <Code inline>{`[data-testid="username"]`}</Code>
    <Code inline>{`[aria-label="username"]`}</Code>
    <Code inline>{`/username/i (Label/placeholder)`}</Code>
  </div>
</div>

(Examples in repo!)

---

### Structure your tests for success ğŸ”¥

---

#### Global custom render function ğŸŒ

<Code>
{`
import { render as r } from '@testing-library/vue';
...
export function render(ui, { store: storeOverrides = {}, ...opts } = {}) {
  return r(
    ui,
    {
      routes,
      store: { ...getDefaultStore(), ...storeOverrides },
      ...opts,
    },
    (vue, store, router) => {
      vue.use(VueI18n);
      vue.use(VeeValidate);
      ...
    },
  );
}
`}
</Code>

---

#### Test specific render function ğŸ’¯

<Code>
{`
async function render(roles = schoolOwnerUser.roles, opts = {}) {
  const utils = r(App, {
    store: { state: { roles } },
    ...opts,
  });
  return {
    ...utils,
    createButton: () => utils.getByText(/create/i),
    itemsList: () => utils.getByTestId('items-list'),
    activeUserSelect: () => utils.getByDisplayValue('active-user'),
    deleteConfirmModal: () => utils.getByRole('dialog')
  };
}
`}
</Code>

---

### Show us a real example! ğŸ˜¤

_`@vsware/norway-permissions`_

---

# Sound! ğŸ‘‹